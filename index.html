<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UESTCæŸ¥è¯¢å“ªäº›æ•™å®¤ç©ºé—²</title>
    <meta name="referrer" content="no-referrer">
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>


<body>
    <!-- æŸ¥è¯¢æ•™å®¤æ˜¯å¦å¯ç”¨ -->
    <!-- <b>æ¡ä»¶ç­›é€‰</b> -->
    <div id="classroom">

        <div id="classroom">
            <div style="text-align:center;">
                <h1>UESTCæŸ¥è¯¢å“ªäº›æ•™å®¤ç©ºé—²V0.7</h1>
                <div>é¡¹ç›®åœ°å€ï¼š<el-link href="https://github.com/jjq419875574/uestc-available-room" target="_blank"
                        type="primary">Github</el-link>
                    <span></span><el-tag size="mini">å·²å¼€æº</el-tag>
                </div>
            </div>
            <hr>
            <div v-show="canSeach">
                <div style="margin-left: 10px;">
                    <el-form label-width="100px">
                        <el-steps :active="3" finish-status="process" simple>
                            <el-step title="å¡«å†™ä¿¡æ¯"></el-step>
                            <el-step title="ç‚¹å‡»æŸ¥è¯¢"></el-step>
                            <el-step title="å¾—åˆ°ç»“æœ"></el-step>
                        </el-steps>
                        <el-divider content-position="left"><i class="el-icon-position"></i>åœ°ç‚¹é€‰æ‹©</el-divider>
                        <div style="font-size: 13px;color: #adb5bd;margin-left:20px;margin-bottom: 10px;">
                            éƒ¨åˆ†ç½‘é¡µæ”¯æŒè‡ªåŠ¨å®šä½,ç›®å‰æ”¯æŒæ•™å­¦æ¥¼çº§åˆ«å®šä½ï¼Œè·ç¦»æ•™å­¦æ¥¼è¾ƒè¿œé‡‡ç”¨æ ¡åŒºçº§åˆ«å®šä½,é»˜è®¤ä½ç½®ä¸ºæ²™æ²³äºŒæ•™å’Œæ¸…æ°´æ²³å“å­¦æ¥¼ã€‚<br />chrome/éƒ¨åˆ†æ‰‹æœºæµè§ˆå™¨å› ä¸ºè°·æ­ŒåŸå› <b>å¯èƒ½ä¸æ”¯æŒä»»ä½•å®šä½</b>ï¼ˆå¯å‚è€ƒ
                            <el-link href="https://developer.chrome.com/blog/geolocation-on-secure-contexts-only/"
                                target="_blank">è¿™ç¯‡æ–‡ç« </el-link>ï¼‰,ä½†edge/safari/é£ä¹¦å†…ç½®æµè§ˆå™¨ç­‰éè°·æ­Œå†…æ ¸æµè§ˆå™¨ä»ç„¶æœ‰æ•ˆã€‚<br />
                            å¯¹äºæ— æ³•ä½¿ç”¨å®šä½çš„æƒ…å†µï¼Œå°†é»˜è®¤ä½¿ç”¨ç¼“å­˜å­˜å‚¨çš„ä¸Šä¸€æ¬¡æŸ¥è¯¢çš„æ•™å­¦æ¥¼åç§°
                        </div>
                        <el-form-item label="æ•™å­¦æ¥¼">
                            <!-- <el-input v-model="building_name"></el-input> -->
                            <el-cascader :options="options" :show-all-levels="true" v-model="building_name"
                                @change="position_has_change=true"></el-cascader>

                            <span v-show='position_has_change==false&&position_has_finish==0'
                                style="color:#4dabf7;margin-left:10px"><i class="el-icon-loading"></i>å®šä½ä¸­,è¯·ç¨ç­‰</span>
                            <span v-show='position_has_change==false&&position_has_finish==-1'
                                style="color:#ffc9c9;margin-left:10px"><i
                                    class="el-icon-circle-close"></i>è‡ªåŠ¨å®šä½å¤±è´¥æˆ–ä¸æ”¯æŒ,è¯·æ‰‹åŠ¨è¾“å…¥</span>
                            <span v-show='position_has_change==false&&position_has_finish==1'
                                style="color:#12b886;margin-left:10px"><i class="el-icon-circle-check
                            "></i>å·²è‡ªåŠ¨æ‹‰å–å®šä½</span>
                        </el-form-item>
                        <el-form-item v-if="areas.show">

                            <template slot="label">
                                åŒºä½é€‰æ‹©
                                <el-popover placement="top-start" title="" width="200" trigger="hover"
                                    content="åœ¨æ¸…æ°´æ²³æ ¡åŒºç«‹äººæ¥¼ã€å“å­¦æ¥¼ã€ç»ç®¡æ¥¼ï¼Œä¼šæœ‰ä»¥Aã€Bã€Cæ ‡è¯†çš„æˆ¿é—´ï¼Œä¸ºäº†æ›´å¥½çš„ç­›é€‰è¿™ç±»æˆ¿é—´ï¼Œæ”¯æŒè¿›è¡Œç­›é€‰">
                                    <i class="el-icon-warning-outline" slot="reference"></i>

                                </el-popover>
                            </template>
                            <div style="display: flex;">
                                <el-checkbox-group v-model="checkedArea">
                                    <el-checkbox v-for="AREA in areas.options" :label="AREA"
                                        :key="AREA">{{building_name[1]+AREA+'åŒº'}}</el-checkbox>
                                </el-checkbox-group>
                            </div>
                        </el-form-item>
                        <el-form-item v-else="areas.show">
                            <template slot="label">
                                åŒºä½é€‰æ‹©
                                <el-popover placement="top-start" title="" width="200" trigger="hover"
                                    content="åœ¨æ¸…æ°´æ²³æ ¡åŒºç«‹äººæ¥¼ã€å“å­¦æ¥¼ã€ç»ç®¡æ¥¼ï¼Œä¼šæœ‰ä»¥Aã€Bã€Cæ ‡è¯†çš„æˆ¿é—´ï¼Œä¸ºäº†æ›´å¥½çš„ç­›é€‰è¿™ç±»æˆ¿é—´ï¼Œæ”¯æŒè¿›è¡Œç­›é€‰">
                                    <i class="el-icon-warning-outline" slot="reference"></i>

                                </el-popover>
                            </template>
                            <div style="color:#ced4da ;">åŒºä½é€‰æ‹©ä»…åœ¨æ¸…æ°´æ²³æ ¡åŒºå“å­¦æ¥¼ã€ç«‹äººæ¥¼ã€ç»ç®¡æ¥¼ä½¿ç”¨</div>
                        </el-form-item>
                        <el-form-item v-if="floor.show">

                            <template slot="label">
                                æ¥¼å±‚é€‰æ‹©
                                <el-popover placement="top-start" title="" width="200" trigger="hover"
                                    content="å°‘éƒ¨åˆ†æ¥¼æ ‹ä¸æ”¯æŒï¼Œè‹¥æ¥¼æ ‹å¯åˆ†åŒºï¼Œä¸åŒåˆ†åŒºå¯æŸ¥è¯¢çš„æ¥¼å±‚ä¸ä¸€å®šç›¸åŒï¼ˆå¦‚ç»ç®¡æ¥¼BåŒºåªå¯æŸ¥è¯¢2ã€3æ¥¼ï¼‰">
                                    <i class="el-icon-warning-outline" slot="reference"></i>

                                </el-popover>
                            </template>
                            <div style="display: flex;">
                                <el-checkbox-group v-model="checkedFloor">
                                    <el-checkbox v-for="Floor in floor.options" :label="Floor"
                                        :key="Floor">{{building_name[1]+Floor+'æ¥¼'}}</el-checkbox>
                                </el-checkbox-group>
                            </div>
                        </el-form-item>
                        <el-form-item v-else="areas.show">
                            <template slot="label">
                                æ¥¼å±‚é€‰æ‹©
                                <el-popover placement="top-start" title="" width="200" trigger="hover"
                                    content="å°‘éƒ¨åˆ†æ¥¼æ ‹ä¸æ”¯æŒï¼Œè‹¥æ¥¼æ ‹å¯åˆ†åŒºï¼Œä¸åŒåˆ†åŒºå¯æŸ¥è¯¢çš„æ¥¼å±‚ä¸ä¸€å®šç›¸åŒï¼ˆå¦‚ç»ç®¡æ¥¼BåŒºåªå¯æŸ¥è¯¢2ã€3æ¥¼ï¼‰">
                                    <i class="el-icon-warning-outline" slot="reference"></i>

                                </el-popover>
                            </template>
                            <div style="color:#ced4da ;">æ¥¼å±‚é€‰æ‹©ä»…åœ¨éƒ¨åˆ†æ¥¼æ ‹ä½¿ç”¨</div>
                        </el-form-item>




                        <el-divider content-position="left"><i class="el-icon-date"></i>æ—¥æœŸé€‰æ‹©</el-divider>
                        <div style="font-size: 13px;color: #adb5bd;margin-left:20px;"><b>æ˜ŸæœŸå‡ +ç¬¬å‡ å‘¨</b> æˆ–è€… <b>æ—¥æœŸ</b>
                            åªéœ€å¡«å†™ä»»æ„ä¸€ç»„ï¼Œå¦ä¸€ç»„ä¼šè‡ªåŠ¨åŒ¹é…ã€‚é»˜è®¤å¡«å†™ä»Šæ—¥çš„
                        </div>
                        <div style="color:red" v-show="isPreTime">
                            å½“å‰éç¬¬ä¸€å‘¨ï¼Œä½†å¯ä¾›æå‰æŸ¥è¯¢ï¼ˆåªèƒ½é€šè¿‡æ•™å­¦å‘¨å‘¨æ•°å’Œæ˜ŸæœŸå‡ æŸ¥è¯¢ï¼‰ï¼Œæ—¥æœŸæŸ¥è¯¢æš‚ä¸å¯ç”¨ï¼ˆå¼€å­¦ç¬¬ä¸€å‘¨å‘¨ä¸€å½“å¤©å¯ç”¨ï¼‰</div>
                        <br /><el-row :gutter="20" type="flex" style="flex-wrap: wrap;">
                            <el-col :span="10">
                                <div class="grid-content bg-purple"></div><el-form-item label="ç¬¬å‡ å‘¨">
                                    <!-- <el-input v-model="week"></el-input> -->
                                    <el-input-number v-model="week" :min="1" :max="25"
                                        @change="week_xqj_change(1)"></el-input-number>
                                </el-form-item>
                                <el-form-item label="æ˜ŸæœŸå‡ ">
                                    <!-- <el-input v-model="xqj"></el-input> -->
                                    <el-input-number v-model="xqj" :min="1" :max="7"
                                        @change="week_xqj_change(1)"></el-input-number>
                                </el-form-item>
                            </el-col>
                            <el-col :span="100">

                                <div class="grid-content bg-purple">

                                    <el-form-item label="æ—¥æœŸ">
                                        <el-date-picker v-model="isPreTime?{}:pickDate" type="date" placeholder="é€‰æ‹©æ—¥æœŸ"
                                            :picker-options="pickerDateOptions" @change="week_xqj_change(2)"
                                            :clearable="false" disabled="isPreTime">
                                        </el-date-picker>
                                    </el-form-item>
                                </div>
                            </el-col>
                        </el-row>

                        <el-divider content-position="left"><i class="el-icon-time"></i>æ—¶é—´é€‰æ‹©</el-divider>
                        <div style="font-size: 13px;color: #adb5bd;margin-left:20px;margin-bottom: 10px;">
                            è¾“å…¥ç©ºé—²çš„æ—¶æ®µè‡ªåŠ¨æŸ¥æ‰¾åŒ¹é…æ•™å®¤ï¼Œå¼€å§‹èŠ‚æ¬¡éœ€è¦å°äºç»“æŸèŠ‚æ¬¡ï¼Œå…¶æ ‡è¯†ç©ºé—²æ•™å®¤ä»<b>ç¬¬xèŠ‚æ¬¡ä¸Šè¯¾æ—¶</b>å¼€å§‹è‡³<b>ç¬¬yèŠ‚æ¬¡ä¸‹è¯¾æ—¶</b>å‡æ— äººã€‚
                            <el-popover placement="top-start" title="èŠ‚æ¬¡æ—¶é—´è¡¨" width="200" trigger="hover">
                                <div v-for="o in time_calendar">
                                    <div style="color:#adb5bd" v-show="o.val<jieci_Next-1">ç¬¬{{o.val}}èŠ‚&nbsp;&nbsp;
                                        {{o.startTime}}~{{o.endTime}}</div>
                                    <div v-show="o.val>=jieci_Next-1">ç¬¬{{o.val}}èŠ‚&nbsp;&nbsp;
                                        {{o.startTime}}~{{o.endTime}}</div>
                                </div>
                                <el-link type="primary" slot="reference">æŸ¥çœ‹èŠ‚æ¬¡æ—¶é—´è¡¨</el-link>
                            </el-popover>
                        </div>
                        <el-form-item label="å¼€å§‹èŠ‚æ¬¡">


                            <!-- <el-input v-model="start"></el-input> -->
                            <el-input-number v-model="start" :min="1" :max="end"></el-input-number>
                        </el-form-item>
                        <el-form-item label="ç»“æŸèŠ‚æ¬¡">
                            <!-- <el-input v-model="end"></el-input> -->
                            <el-input-number v-model="end" :min="start" :max="12"></el-input-number>
                        </el-form-item>
                        <el-checkbox v-model="canLocalstorage" size="mini"
                            style="margin-left:100px;margin-bottom: 10px;">
                            å¯ç”¨ç¼“å­˜è®°å½•ä¸Šæ¬¡æŸ¥è¯¢æ•™å­¦æ¥¼
                            <el-popover placement="top-start" title="ç¼“å­˜å¹²å•¥ï¼Ÿ" width="200" trigger="hover"
                                content="å› ä¸ºchromeå†…æ ¸æµè§ˆå™¨ä¸æ”¯æŒå®šä½æœåŠ¡ï¼Œå› æ­¤å¯ä»¥å¯åŠ¨ç¼“å­˜åŠŸèƒ½ï¼Œè®°å½•ä¸Šä¸€æ¬¡ç‚¹å‡»æŸ¥è¯¢çš„æ•™å­¦æ¥¼åç§°ï¼Œä»¥æ–¹ä¾¿ä¸‹ä¸€æ¬¡æŸ¥è¯¢ã€‚å¦‚æœæ‚¨çš„æµè§ˆå™¨æ”¯æŒå®šä½,å¼€å¯åæ— å½±å“ï¼Œå®šä½åä»ç„¶é»˜è®¤ä¸ºå®šä½ä½ç½®">
                                <i class="el-icon-question" slot="reference"></i>
                            </el-popover>
                        </el-checkbox>
                        <el-form-item>
                            <el-button type="primary" @click="find_available_classroom()"
                                :loading="search_has_finish==2" style="margin-top:10px">æŸ¥è¯¢å¯ç”¨æ•™å®¤</el-button>
                            <!-- <el-button type="danger" plain v-show="search_percentage>0" @click="clear_()">æ¸…ç©ºæŸ¥è¯¢</el-button> -->
                            <el-button type="warning" round icon="el-icon-remove-outline" @click="stopNow()"
                                v-show="search_has_finish==2" style="margin-top:10px">ç»ˆæ­¢æŸ¥è¯¢</el-button>
                            <el-button type="danger" plain v-show="search_has_finish==1||search_has_finish==3"
                                @click="clear_()" style="margin-top:10px">æ¸…ç©ºæŸ¥è¯¢ç»“æœ</el-button>

                        </el-form-item>

                    </el-form>
                </div>

                <!-- å¯ç”¨æ•™å®¤åˆ—è¡¨ -->
                <el-card v-if="available.length >= 0" style="width:80%;margin:0 auto;">
                    <div slot="header" style="display: flex;justify-content: space-between;flex-wrap: wrap;">
                        <div style="font-weight: bold;">å¯ç”¨æ•™å®¤åˆ—è¡¨ï¼š</div>
                        <div>
                            <div style="display: inline-block;float: left;font-size:14px">æŸ¥è¯¢è¿›åº¦ &nbsp;</div>
                            <div style="display: inline-block;float: right;min-width:250px">
                                <el-progress :text-inside="true" :stroke-width="22" :percentage="search_percentage"
                                    :color="percentagecustomColors" status="warning"></el-progress>
                            </div>
                        </div>

                    </div>
                    <div>
                        <span v-if="available.length==0&& search_percentage<=0" style="color:#ff6b6b">è¯·è¾“å…¥ä¿¡æ¯åç‚¹å‡»æŸ¥è¯¢</span>
                        <span v-else-if="search_percentage>0&& search_percentage<100&&search_has_finish!=3"
                            style="color:#2862d6" style="margin-bottom: 10px;"><i
                                class="el-icon-loading"></i>æŸ¥è¯¢å†…å®¹è¾ƒå¤šï¼Œè¯·ç¨ç­‰</span>
                        <el-alert v-else-if="search_has_finish==3" :title="'æŸ¥è¯¢è¢«ç»ˆæ­¢,ç›®å‰å…±æŸ¥è¯¢åˆ°'+available.length+'ä¸ªæ•™å®¤'"
                            type="warning" show-icon :closable="false">
                        </el-alert><br v-else-if="search_has_finish==3" />
                        <el-alert v-if="search_has_finish==1" :title="'æŸ¥è¯¢æˆåŠŸ,å…±æŸ¥è¯¢åˆ°'+available.length+'ä¸ªæ•™å®¤'" type="success"
                            show-icon :closable="false">
                        </el-alert><br />
                        <!-- æç¤º -->



                        <span v-for="room in available" :key="room"> &nbsp;{{ room }}&nbsp; </span>

                        <el-empty v-if="(search_has_finish==1) && available.length==0 "
                            description="'æ‚¨çš„ç­›é€‰æ¡ä»¶ä¸‹æš‚æ— ç©ºé—²æ•™å®¤"></el-empty>
                        <el-empty v-else-if="(search_has_finish==3) && available.length==0 "
                            description="æ‚¨ä¸­æ–­äº†æŸ¥è¯¢ï¼Œåœ¨å·²ç»æŸ¥è¯¢çš„æ•™å®¤ä¸­ï¼Œæ‚¨çš„ç­›é€‰æ¡ä»¶ä¸‹æš‚æ— ç©ºé—²æ•™å®¤"></el-empty>
                    </div>
                </el-card>
            </div>
            <div v-show="!canSeach">
                <el-alert title="æš‚åœæœåŠ¡" type="warning" description="ç°åœ¨å·²ç»åˆ°äº†èŠ‚å‡æ—¥ï¼Œæœ¬æœåŠ¡æš‚åœï¼Œå¼€å­¦å½“å¤©ï¼ˆå‘¨ä¸€ï¼‰ä¼šæ¢å¤ã€‚" show-icon center
                    :closable="false">
                </el-alert>
            </div>
        </div>



    </div>
    <!-- å¼€å‘ç¯å¢ƒç‰ˆæœ¬ï¼ŒåŒ…å«äº†æœ‰å¸®åŠ©çš„å‘½ä»¤è¡Œè­¦å‘Š -->

    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script> -->
    <script src="./vue.min.js"></script>
    <!-- å®˜ç½‘æä¾›çš„ axios åœ¨çº¿åœ°å€ -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- å¼•å…¥elementç»„ä»¶ -->
    <!-- å¼•å…¥æ ·å¼ -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- å¼•å…¥ç»„ä»¶åº“ -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- è‡ªå·±çš„js -->
    <script>
        var classroom = new Vue({
            el: '#classroom',
            data: {
                class_list: [],
                classroom_id: '',
                week: 4,
                section: '',
                xqj: 1,
                classroom_is_available: '',
                start: 9,
                end: 10,
                building: [],
                available: [],
                building_name: ['æ²™æ²³', 'äºŒæ•™'],
                options: [{
                    value: 'æ¸…æ°´æ²³',
                    label: 'æ¸…æ°´æ²³æ ¡åŒº',
                    children: [{ value: 'å“å­¦æ¥¼', label: 'å“å­¦æ¥¼' }, { value: 'ç«‹äººæ¥¼', label: 'ç«‹äººæ¥¼' }, { value: 'ç»ç®¡æ¥¼', label: 'ç»ç®¡æ¥¼' }, { value: 'å­¦ç”Ÿå‘å±•ä¸­å¿ƒ', label: 'å­¦ç”Ÿå‘å±•ä¸­å¿ƒ' }, { value: 'ä¸»æ¥¼', label: 'æ¸…æ°´æ²³ä¸»æ¥¼' }]
                }, {
                    value: 'æ²™æ²³',
                    label: 'æ²™æ²³æ ¡åŒº',
                    children: [{ value: 'äºŒæ•™', label: 'äºŒæ•™' }, { value: 'å››æ•™', label: 'å››æ•™' }, { value: 'ä¸»æ¥¼', label: 'æ²™æ²³ä¸»æ¥¼' },]
                }],

                //æ•™å­¦åŒºåŸŸé€‰æ‹©
                checkedArea: [],
                checkedFloor: [],

                //ç¬¬äºŒé€‰æ‹©
                startMon: '',
                pickDate: '',
                canLocalstorage: true,


                position_has_change: false,
                position_has_finish: 0,


                time_calendar: [{
                    val: 1,
                    startTime: '8:30',
                    endTime: '9:15'
                }, {
                    val: 2,
                    startTime: '9:20',
                    endTime: '10:05'
                }, {
                    val: 3,
                    startTime: '10:20',
                    endTime: '11:05'
                }, {
                    val: 4,
                    startTime: '11:10',
                    endTime: '11:55'
                }, {
                    val: 5,
                    startTime: '14:30',
                    endTime: '15:15'
                }, {
                    val: 6,
                    startTime: '15:20',
                    endTime: '16:05'
                }, {
                    val: 7,
                    startTime: '16:20',
                    endTime: '17:05'
                }, {
                    val: 8,
                    startTime: '17:10',
                    endTime: '17:55'
                }, {
                    val: 9,
                    startTime: '19:30',
                    endTime: '20:15'
                }, {
                    val: 10,
                    startTime: '20:20',
                    endTime: '21:05'
                }, {
                    val: 11,
                    startTime: '21:10',
                    endTime: '21:55'
                }, {
                    val: 12,
                    startTime: '22:00',
                    endTime: '22:45'
                }],
                jieci_Next: 0,


                //è¿›åº¦æ¡
                search_percentage: 0,
                search_has_finish: 0,//0 æœªå¼€å§‹ï¼›1ç»“æŸï¼›2è¿›è¡Œä¸­
                percentagecustomColors: [
                    { color: '#ffc9c9', percentage: 25 },
                    { color: '#fcc2d7', percentage: 50 },
                    { color: '#ffd8a8', percentage: 75 },
                    { color: '#ffe066', percentage: 95 },
                    { color: '#96f2d7', percentage: 100 }
                ],


                //å…è®¸æŸ¥è¯¢ï¼Ÿ
                canSeach: true,
                isPreTime: false,
                //æ˜¯å¦å¼€å¯äº†æå‰æŸ¥è¯¢ï¼Œä¿¡æ¯ä¸­å¿ƒå¯èƒ½æå‰ä¸€å‘¨å¼€å§‹æŸ¥è¯¢ã€‚æ­¤æ—¶è§†ä¸ºæå‰æŸ¥è¯¢ã€‚æ—¥æœŸé€‰é¡¹å¯èƒ½ä¸ä½œæ•°ã€‚
            },
            created() {


                // ä» localStorage ä¸­è·å–ä¿å­˜çš„ JSON å­—ç¬¦ä¸²
                var jsonArray = localStorage.getItem("uestcFindAvailableBuilding");
                if (jsonArray != null) {
                    this.building_name = JSON.parse(jsonArray);
                }
                this.get_Thisweek();
                //è·å–å½“å‰æ˜ŸæœŸå‡ 
                this.get_xqj();
                this.getlocation();

                setTimeout(() => {
                    if (this.pickerDateOptions.disabledDate(new Date(), this)) {
                        //å¦‚æœä»Šå¤©åœ¨æŸ¥è¯¢èŒƒå›´ä¹‹å¤–
                        this.canSeach = false;
                        return;
                    }
                    console.info(">>ğŸŒ¼ç¬¬ä¸€å‘¨å¼€å§‹æ—¥æœŸï¼š", this.startMon, "è‹¥å½“å‰æ˜¯ç¬¬0å‘¨ï¼Œåˆ™æ­¤æ•°æ®ä¸å‡†ç¡®")
                    this.TimeNow();
                }, 5);


            },
            computed: {
                //ç¬¬äºŒé€‰æ‹©
                pickerDateOptions() {
                    let that_ = this;
                    return {
                        disabledDate(time, that = that_) {
                            const currentDate = new Date();
                            const currentYear = currentDate.getFullYear();
                            const currentMonth = currentDate.getMonth() + 1;
                            const currentDay = currentDate.getDate();
                            const startDate = new Date(that.startMon);

                            const endDate = new Date(startDate.getTime() + ((25 * 7 - 1) * 24 * 60 * 60 * 1000)); // å°†æ—¥æœŸå‘åæ¨è¿› 25 å‘¨
                            return time.getTime() < startDate || time.getTime() > endDate;
                        },


                    }
                },
                areas() {
                    let building = this.building_name[1];
                    let show = false;
                    let option = []

                    if (building.includes("å“å­¦æ¥¼") || building.includes("ç«‹äººæ¥¼") || building.includes("ç»ç®¡æ¥¼")) {
                        show = true;
                        if (building.includes("ç«‹äººæ¥¼")) {
                            option = ['A', 'B'];
                            this.checkedArea = ['A', 'B'];
                        } else {
                            option = ['A', 'B', 'C'];
                            this.checkedArea = ['A', 'B', 'C'];
                        }
                    } else {
                        show = false;
                    }
                    return { options: option, show: show }


                },
                floor() {
                    let building = this.building_name[1];
                    let xiaoqu = this.building_name[0];
                    let show = false;
                    let option = []

                    if (building.includes("å­¦ç”Ÿå‘å±•ä¸­å¿ƒ")) {
                        show = true;
                        option = ['1', '2']
                        this.checkedFloor = option;
                    } else if (building.includes("ç»ç®¡æ¥¼")) {
                        show = true;
                        option = ['2', '3']

                        if (this.checkedArea.includes('C')) {
                            option.push('5');
                            if (!option.includes('1')) {
                                option.push('1');
                            }
                        }
                        if (this.checkedArea.includes('A')) {
                            option.push('4');
                            if (!option.includes('1')) {
                                option.push('1');
                            }
                        }
                        option.sort();

                        //A:1\2\3\4
                        //B:2\3
                        //C:1\2\3\5

                        this.checkedFloor = option;
                    } else if (building.includes('å“å­¦æ¥¼') || building.includes('ç«‹äººæ¥¼')) {
                        show = true;
                        option = ['1', '2', '3', '4'];
                        if (this.checkedArea.includes('C')) {
                            option.push('5');

                        }
                        this.checkedFloor = option;
                    } else if (building.includes('ä¸»æ¥¼') && xiaoqu == 'æ¸…æ°´æ²³') {
                        show = true;
                        option = ['1', '5', '7', '8'];
                        this.checkedFloor = option;
                    } else if (building.includes('å››æ•™')) {
                        show = true;
                        option = ['1', '2', '3'];
                        this.checkedFloor = option;
                    }
                    else if (building.includes('äºŒæ•™')) {
                        show = true;
                        option = ['1', '2', '3', '4'];
                        this.checkedFloor = option;
                    } else if (building.includes('ä¸»æ¥¼') && xiaoqu == 'æ²™æ²³') {
                        show = true;
                        option = ['1', '2', '3', '4', '5'];
                        this.checkedFloor = option;
                    }
                    else {
                        show = false;
                    }
                    return { options: option, show: show }


                }
            },
            methods: {

                async allClassroom() {
                    let that = this;
                    return new Promise((resolve, reject) => {
                        axios({
                            url: 'https://studyapi.uestc.edu.cn/api/pub/exp/school/data',
                            method: 'post',
                            data: { "type": "allclassroom", "data": [{}] },
                            timeout: 1000,
                            headers: 'Content-Type: application/json'
                        }).then(function (response) {
                            that.class_list = response.data.data;
                            resolve(that.class_list)
                        }).catch(function (error) {
                            reject();
                        })
                    })


                },
                async searchClassroom() {
                    var that = this;
                    return new Promise((resolve, reject) => {
                        axios({
                            url: 'https://studyapi.uestc.edu.cn/api/pub/exp/school/data',
                            method: 'post',
                            data: { "type": "thisweek_courseschedule", "data": [{ "room_name": that.classroom_id, "qqdjz": that.week }] },
                            timeout: 1000,
                            headers: 'Content-Type: application/json'
                        }).then(function (response) {
                            resolve(response)
                        }).catch(function (err) {
                            console.log(err);
                        })
                    })



                },


                //æŸ¥è¯¢æ‰€æœ‰äºŒæ•™çš„å¯ç”¨æ•™å®¤
                async search_special_building() {
                    var that = this;
                    that.building = [];
                    let cleaned_building_name = that.building_name[1];
                    let school_area = that.building_name[0]

                    return new Promise(function (resolve, reject) {  //promise åˆ›å»ºresolveå’Œrejectå‡½æ•° ç”¨äºå›è°ƒå‡½æ•°çš„ä¸¤
                        // var i=0;
                        axios({
                            url: 'https://studyapi.uestc.edu.cn/api/pub/exp/school/data',
                            method: 'post',
                            data: { "type": "allclassroom", "data": [{}] },
                            // timeout: 1000,
                            headers: 'Content-Type: application/json',
                            async: false,
                        }).then(function (response) {

                            for (var k = 0; k < that.class_list.length; k++) {
                                if (that.class_list[k].building == cleaned_building_name && that.class_list[k].school == school_area) {
                                    that.building.push(that.class_list[k]);
                                }//ä»ç´¢å¼• 1 å¼€å§‹æˆªå–å­—ç¬¦ä¸²)
                            }//æŸ¥æ‰¾éœ€è¦æŸ¥æ‰¾çš„æ‰€æœ‰æ•™å®¤åˆ—è¡¨å¹¶ä¸”å­˜å…¥buildingæ•°ç»„ä¸­
                            // console.log(that.building[0]);
                            // that.$options.methods.find_available_classroom();

                            console.log(that.building);
                            resolve(that.building)

                        }
                        ).catch(function (err) {
                            console.log(err);
                        }
                        )
                    })
                },


                matchStrings(prex, str) {

                    var remainingStr = str.substring(prex.length);



                    var firstChar = remainingStr.charAt(0);
                    var secondChar = remainingStr.charAt(1);

                    return this.checkedArea.includes(firstChar) && this.checkedFloor.includes(secondChar);
                },
                checkFrom() {
                    if (this.areas.show && this.checkedArea.length == 0) {
                        this.$notify.error({
                            title: 'é”™è¯¯',
                            message: 'åŒºä½é€‰æ‹©å¿…é¡»é€‰æ‹©è‡³å°‘ä¸€ä¸ª'
                        });
                        return false;
                    } else if (this.floor.show && this.checkedFloor.length == 0) {

                        this.$notify.error({
                            title: 'é”™è¯¯',
                            message: 'æ¥¼å±‚é€‰æ‹©å¿…é¡»é€‰æ‹©è‡³å°‘ä¸€ä¸ª'
                        });
                        return false;
                    }
                    return true;

                },
                async find_available_classroom() {
                    if (!this.checkFrom()) {
                        return
                    }

                    // å°† JSON å­—ç¬¦ä¸²ä¿å­˜åˆ° localStorage ä¸­çš„åä¸º "myArray" çš„é”®ä¸­
                    if (this.canLocalstorage) {
                        let jsonArray = JSON.stringify(this.building_name);
                        localStorage.setItem("uestcFindAvailableBuilding", jsonArray);
                    }
                    else {
                        localStorage.clear();
                    }


                    this.available = [];
                    this.search_has_finish = 2;
                    this.search_percentage = 0;
                    await this.allClassroom();
                    await this.search_special_building();
                    var that = this;
                    let room_num = that.building.length;
                    for (i = 0; i < that.building.length; i++) {
                        if (this.search_has_finish == 3) {
                            break;
                        }
                        //ä½¿å¾—axioè°ƒç”¨åå†æ‰§è¡Œfor
                        var that = this;
                        var tmp_room_name = that.building[i].building + that.building[i].room_name;
                        // console.log(that.building[0]);
                        // console.log(tmp_room_name);

                        if (this.areas.show == true && this.floor.show == true) {

                            // if (!this.checkedArea.some(function (area) {
                            //     let matchstr = that.building_name[1] + area
                            //     return tmp_room_name.includes(matchstr);
                            // })) {
                            //     that.search_percentage = Math.floor(((i + 1) / room_num * 100) * 100) / 100;
                            //     if (that.search_percentage == 100) {
                            //         that.search_has_finish = 1
                            //     }
                            //     continue;
                            // } else if ()
                            if (!this.matchStrings(that.building_name[1], tmp_room_name)) {
                                that.search_percentage = Math.floor(((i + 1) / room_num * 100) * 100) / 100;
                                if (that.search_percentage == 100) {
                                    that.search_has_finish = 1
                                }
                                continue;
                            }
                        } else if (this.floor.show == true) {
                            if (!this.checkedFloor.some(function (area) {
                                let matchstr = that.building_name[1] + area
                                return tmp_room_name.includes(matchstr);
                            })) {
                                that.search_percentage = Math.floor(((i + 1) / room_num * 100) * 100) / 100;
                                if (that.search_percentage == 100) {
                                    that.search_has_finish = 1
                                }
                                continue;
                            }
                        }
                        await axios({
                            url: 'https://studyapi.uestc.edu.cn/api/pub/exp/school/data',
                            method: 'post',
                            data: { "type": "thisweek_courseschedule", "data": [{ "room_name": that.building[i].building + that.building[i].room_name, "qqdjz": that.week }] },

                            // timeout: 1000,
                            headers: 'Content-Type: application/json',
                            saync: false,
                        }).then(function (response) {
                            console.log(response.data.data);
                            that.search_percentage = Math.floor(((i + 1) / room_num * 100) * 100) / 100;

                            var is_avail = true;

                            for (var j = 0; j < response.data.data.length; j++) {
                                // console.log(response.data.data[j].ksjc);
                                // console.log(that.end);
                                // console.log(response.data.data[j].ksjc >= that.end || response.data.data[j].jsjc <= that.start);
                                let [s, e] = response.data.data[j].kksd.split('-').map(Number);
                                if (that.search_has_finish == 3) {
                                    is_avail = false;
                                    break;
                                }
                                if (response.data.data[j].xqj == that.xqj && that.week >= s && (that.week <= e || e == undefined) && !(response.data.data[j].jsjc <= that.start || response.data.data[j].ksjc >= that.end)) {
                                    is_avail = false;

                                }

                                else {
                                    continue;
                                }

                            }
                            if (is_avail) {
                                that.available.push(tmp_room_name);
                                console.log(tmp_room_name);
                            }
                            if (this.search_has_finish == 3) {
                                return;
                            }
                            if (that.search_percentage == 100) {
                                that.search_has_finish = 1
                            }






                        }).catch(function (err) {
                            console.log(err);
                        })


                    }//å°†æ‰€æœ‰æ•™å®¤åå­—å­˜å…¥availableæ•°ç»„ä¸­
                },

                // è·å–ç¬¬å‡ å‘¨
                get_Thisweek: function () {
                    var that = this;
                    axios({
                        url: 'https://studyapi.uestc.edu.cn/ckd/getWeek',
                        method: 'get',
                        timeout: 1000,

                    }).then(function (response) {
                        that.week = response.data;
                        if (that.week < 0) {
                            that.week = 1;
                            that.isPreTime = true;
                        }
                        that.startMon = that.getPreviousWeekDateAndNextMonday(new Date(), that.week);
                        // console.log(that.week);
                    }).catch(function (error) {
                        console.log(error);
                    })

                },
                // è·å–æ˜ŸæœŸå‡ 
                get_xqj() {
                    //ç”¨jsè·å–æ˜ŸæœŸå‡ 
                    var now = new Date();
                    var day = now.getDay();
                    var weeks = new Array("7", "1", "2", "3", "4", "5", "6");
                    var week = weeks[day];
                    this.xqj = parseInt(week);
                    this.pickDate = new Date()

                },


                //æ¸…ç©ºæŸ¥è¯¢
                clear_() {

                    this.search_percentage = 0;
                    this.search_has_finish = 0;
                    this.available = [];
                    this.$notify({
                        title: 'æˆåŠŸ',
                        message: 'å·²ç»æ¸…ç©ºæŸ¥è¯¢ç»“æœ',
                        type: 'success'
                    });

                },



                /**
                 * @description: è·å–ç¬¬ä¸€å‘¨çš„æ˜ŸæœŸä¸€çš„æ—¥æœŸ
                 * @param {*} dateï¼šå½“å‰æ—¥æœŸ
                 * @param {*} xï¼šå½“å‰ç¬¬å‡ å‘¨
                 * @return {*}
                 */
                getPreviousWeekDateAndNextMonday(date, x) {
                    var currentDate = new Date(date.getTime());
                    var previousWeekDate = new Date(currentDate.getTime() - (x * 7 * 24 * 60 * 60 * 1000));

                    var year = previousWeekDate.getFullYear();
                    var month = previousWeekDate.getMonth() + 1;
                    var day = previousWeekDate.getDate();

                    var previousWeekDateString = year + '-' + month + '-' + day;

                    var nextMondayDate = new Date(previousWeekDate);
                    if (nextMondayDate.getDay() == 0) {
                        nextMondayDate.setDate(nextMondayDate.getDate() - nextMondayDate.getDay() + 1);
                    }
                    else {
                        nextMondayDate.setDate(nextMondayDate.getDate() - nextMondayDate.getDay() + 1 + 7);
                    }


                    var nextMondayYear = nextMondayDate.getFullYear();
                    var nextMondayMonth = nextMondayDate.getMonth() + 1;
                    var nextMondayDay = nextMondayDate.getDate();

                    var nextMondayString = nextMondayYear + '-' + nextMondayMonth + '-' + nextMondayDay;

                    return nextMondayString;
                },

                week_xqj_change(flag) {
                    if (this.week == null || this.xqj == null) {
                        return;
                    }
                    else if (flag == 1) {
                        const startDate = new Date(this.startMon); // è½¬æ¢ä¸ºDateå¯¹è±¡
                        const targetDate = new Date(startDate.getTime() + (this.week - 1) * 7 * 24 * 60 * 60 * 1000); // è®¡ç®—ç›®æ ‡æ—¥æœŸ

                        // è°ƒæ•´ç›®æ ‡æ—¥æœŸä¸ºå¯¹åº”çš„æ˜ŸæœŸå‡ 
                        targetDate.setDate(targetDate.getDate() + (this.xqj - targetDate.getDay() + 7) % 7);

                        const year = targetDate.getFullYear();
                        const month = targetDate.getMonth() + 1;
                        const day = targetDate.getDate();

                        this.pickDate = `${year}-${month}-${day}`;
                    }
                    else {
                        const startDate = new Date(this.startMon); // è½¬æ¢ä¸ºDateå¯¹è±¡
                        const targetDate = new Date(this.pickDate); // è½¬æ¢ä¸ºDateå¯¹è±¡
                        targetDate.setHours(0, 0, 0);
                        const timeDiff = targetDate.getTime() - startDate.getTime(); // è®¡ç®—é€‰å®šæ—¥æœŸä¸ç¬¬ä¸€å‘¨çš„æ—¶é—´å·®
                        // console.warn(targetDate)
                        this.week = Math.ceil(timeDiff / (7 * 24 * 60 * 60 * 1000)) + 1; // è®¡ç®—å¯¹åº”çš„å‘¨æ•°
                        const xqj_tmp = targetDate.getDay(); // è·å–é€‰å®šæ—¥æœŸæ˜¯æ˜ŸæœŸå‡ ï¼ˆ0è¡¨ç¤ºæ˜ŸæœŸå¤©ï¼Œ1è¡¨ç¤ºæ˜ŸæœŸä¸€ï¼Œä»¥æ­¤ç±»æ¨ï¼‰
                        if (xqj_tmp == 0) {
                            this.xqj = 7;
                            this.week = this.week - 1;
                        } else {
                            this.xqj = xqj_tmp;
                        }
                    }
                },




                /**
                 * @description: è·å–ä½ç½®
                 * @return {*}
                 */
                getlocation() {
                    let that = this;
                    if (navigator.geolocation) {
                        var n = navigator.geolocation.getCurrentPosition(
                            function (res) {
                                console.warn('åœ°ç†ä¿¡æ¯(è¾…åŠ©åˆ¤æ–­ä½ç½®)', res); // éœ€è¦çš„åæ ‡åœ°å€å°±åœ¨resä¸­
                                that.handleGPS(res);
                            },
                            function (err) {
                                console.warn(err)
                                that.position_has_finish = -1;
                            },
                            {
                                enableHighAccuracy: false,
                                timeout: 5000,
                            }
                        );

                    } else {
                        that.position_has_finish = -1;
                    }
                },
                handleGPS(res) {

                    // longitude1 = 103.93858
                    // //ï¼Œçº¬åº¦ï¼š
                    // latitude1 = 30.75596
                    // // console.log(res.coords.latitude)
                    if (this.position_has_change) {
                        //ä½ç½®å·²ç»è¢«æ‰‹å·¥ä¿®æ”¹
                        return;
                    }
                    const options = [
                        {
                            val: ['æ²™æ²³', 'å››æ•™'],
                            long: 104.10627,//ç²¾åº¦
                            dim: 30.68114,//ç»´åº¦
                            area: 120,//èŒƒå›´
                        },
                        {
                            val: ['æ²™æ²³', 'ä¸»æ¥¼'],
                            long: 104.10768,//ç²¾åº¦
                            dim: 30.67970,//ç»´åº¦
                            area: 100,//èŒƒå›´
                        },
                        {
                            val: ['æ²™æ²³', 'äºŒæ•™'],
                            long: 104.10942,//ç²¾åº¦
                            dim: 30.68034,//ç»´åº¦
                            area: 8000,//èŒƒå›´
                        },
                        {
                            val: ['æ¸…æ°´æ²³', 'ç«‹äººæ¥¼'],
                            long: 103.93890,//ç²¾åº¦
                            dim: 30.75506,//ç»´åº¦
                            area: 130,//èŒƒå›´
                        },
                        {
                            val: ['æ¸…æ°´æ²³', 'ç»ç®¡æ¥¼'],
                            long: 103.93902,//ç²¾åº¦
                            dim: 30.75504,//ç»´åº¦
                            area: 150,//èŒƒå›´
                        },
                        {
                            val: ['æ¸…æ°´æ²³', 'å­¦ç”Ÿæ´»åŠ¨ä¸­å¿ƒ'],
                            long: 103.93547,//ç²¾åº¦
                            dim: 30.76143,//ç»´åº¦
                            area: 120,//èŒƒå›´
                        },
                        {
                            val: ['æ¸…æ°´æ²³', 'ä¸»æ¥¼'],
                            long: 103.93330,//ç²¾åº¦
                            dim: 30.75240,//ç»´åº¦
                            area: 250,//èŒƒå›´
                        },
                        {
                            val: ['æ¸…æ°´æ²³', 'å“å­¦æ¥¼'],
                            long: 103.93918,//ç²¾åº¦
                            dim: 30.75734,//ç»´åº¦
                            area: 40000,//èŒƒå›´
                        },
                    ]
                    let closestOption = null;
                    let minDistance = Infinity;

                    for (const option of options) {
                        const distance = this.calculateDistance(res.coords.longitude, res.coords.latitude, option.long, option.dim);
                        // const distance = this.calculateDistance(longitude1, latitude1, option.long, option.dim);
                        console.log('æµ‹è·-->', option, distance);
                        if (distance < minDistance && distance * 100000 <= option.area) {
                            minDistance = distance;
                            closestOption = option;
                        }
                    }

                    if (closestOption) {
                        this.building_name = closestOption.val
                        this.position_has_finish = 1;
                    }
                    else {
                        this.position_has_finish = -1;
                    }



                },
                // è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ˆä½¿ç”¨ç®€åŒ–çš„è®¡ç®—å…¬å¼ï¼‰
                calculateDistance(long1, dim1, long2, dim2) {
                    const dx = long2 - long1;
                    const dy = dim2 - dim1;
                    return Math.sqrt(dx * dx + dy * dy);
                },



                TimeNow() {

                    const currentTime = new Date();
                    const currentHour = currentTime.getHours();
                    const currentMinute = currentTime.getMinutes();

                    const time_calendar = this.time_calendar;

                    let closestTime = null;
                    let closestValue = null;

                    for (let i = 0; i < time_calendar.length; i++) {
                        const startTimeParts = time_calendar[i].startTime.split(':');
                        const startHour = parseInt(startTimeParts[0]);
                        const startMinute = parseInt(startTimeParts[1]);

                        if (currentHour < startHour || (currentHour === startHour && currentMinute < startMinute)) {
                            if (closestTime === null ||
                                (startHour - currentHour) * 60 + (startMinute - currentMinute) < closestTime) {
                                closestTime = (startHour - currentHour) * 60 + (startMinute - currentMinute);
                                closestValue = time_calendar[i].val;
                            }
                        }
                    }
                    // console.log(closestValue)
                    if (closestValue == null) {
                        this.start = 1;
                        this.end = 1 + 1;

                        var date = new Date(this.pickDate);

                        // å°†æ—¥æœŸåŠ ä¸€å¤©
                        date.setDate(date.getDate() + 1);

                        // å°†æ–°çš„æ—¥æœŸè½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼
                        this.pickDate = date.toISOString().slice(0, 10);
                        setTimeout(() => {
                            this.week_xqj_change(2);
                        }, 1000)
                        this.$message('ä»Šæ—¥æ•™å­¦ä»»åŠ¡å·²ç»ç»“æŸï¼ŒæŸ¥è¯¢æ—¥æœŸè‡ªåŠ¨è®¾ç½®ä¸ºæ˜æ—¥æ—¥æœŸï¼Œæ‚¨å¯ä»¥è‡ªè¡Œä¿®æ”¹');
                        this.jieci_Next = 13;
                        return


                    }
                    else if (closestValue < 12) {

                        this.start = closestValue;
                        this.end = closestValue + 1;
                    }
                    else {
                        this.start = 11;
                        this.end = closestValue + 1;
                    }
                    this.jieci_Next = closestValue
                    this.$message('å·²æˆåŠŸè·å–å½“å‰æ—¥æœŸå’Œæœ€è¿‘èŠ‚æ¬¡');
                    return

                },
                stopNow() {
                    this.search_has_finish = 3;

                }








            },


        })
    </script>


</body>

</html>